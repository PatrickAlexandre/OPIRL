<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🦄 PUREVital ⚡💖🎮 ARG MMORPG💫</title>
    <link rel="icon" type="image/png" href="img/EnerGGY.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        .hidden {
            display: none;
        }
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: black;
            color: #fff;
            text-align: center;
            border-radius: 5px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%; 
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>

<body class="bg-gray-800 text-white font-sans leading-normal tracking-normal">
    <div class="container mx-auto p-4">
        <!-- Profile Section -->
        <div class="bg-gray-900 p-4 rounded-lg flex items-center space-x-4">
            <img title="Cliquez ici pour remplacer votre photo de profil" src="https://i.gifer.com/6Dg.gif" id="replaceableImage" class="rounded-full w-24 mx-auto cursor-pointer border-4 border-solid border-gray-800" alt="🧬" onclick="captureImage()">
            <video id="camera" class="hidden" autoplay></video>
            <canvas id="canvas" class="hidden"></canvas>
            <img src="https://placehold.co/50x50" alt="Faction logo" class="hidden w-12 h-12">
            <div>
                <div class="flex items-center space-x-2 mb-2">
                    <span class="font-bold text-pink-500 text-lg overflow-hidden" contenteditable="true">Johanna</span>
                    <span class="text-sm">
                        <select id="mbti-type" class="bg-gray-800 text-white border border-gray-700 rounded px-2 py-1" onchange="changeBackgroundColor()">
                            <option value="default">Select MBTI Type</option>
                            <option value="ISTJ">ISTJ</option>
                            <option value="ISFJ">ISFJ</option>
                            <option value="INFJ">INFJ</option>
                            <option value="INTJ">INTJ</option>
                            <option value="ISTP">ISTP</option>
                            <option value="ISFP">ISFP</option>
                            <option value="INFP">INFP</option>
                            <option value="INTP">INTP</option>
                            <option value="ESTP">ESTP</option>
                            <option value="ESFP">ESFP</option>
                            <option value="ENFP">ENFP</option>
                            <option value="ENTP">ENTP</option>
                            <option value="ESTJ">ESTJ</option>
                            <option value="ESFJ">ESFJ</option>
                            <option value="ENFJ">ENFJ</option>
                            <option value="ENTJ">ENTJ</option>
                        </select>
                    </span>
                </div>
                <!--🔋 Life Percentage  -->
                <div id="lifePercentage" class="bg-green-500 h-6 overflow-hidden rounded" role="progressbar" style="width: 0%;"></div>

                <div class="flex items-center space-x-4">
                    <span class="text-yellow-400"><i class="fas fa-shield-alt"></i> 14565</span>
                    <span class="flex items-center text-blue-400">
                        <i class="fas fa-hourglass-half mr-2"></i>
                        <span id="displayed-age">0</span>
                    </span>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="mt-4 bg-gray-900 p-2 rounded-lg flex justify-around">
            <button id="character-btn" class="bg-yellow-500 py-1 px-4 rounded text-black font-bold">PERSONNAGE</button>
            <button class="text-yellow-500">HAUTS FAITS</button>
            <button class="text-yellow-500">COLLECTIONS</button>
        </div>

        <!-- Game Stats Section -->
        <div class="mt-4 bg-gray-900 p-4 rounded-lg">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="tooltip">
                    <div class="flex items-center space-x-2 bg-gray-700 p-4 rounded">
                        <i class="fas fa-tachometer-alt text-orange-400"></i>
                        <span id="nap" class="text-orange-400">(NAP)</span>
                    </div>
                    <span class="tooltiptext">Niveau d'Activité Physique</span>
                </div>
                <div class="tooltip">
                    <div class="flex items-center space-x-2 bg-gray-700 p-4 rounded">
                        <i class="fas fa-fire text-purple-400"></i>
                        <span id="bmr" class="text-purple-400">(BMR)</span>
                    </div>
                    <span class="tooltiptext">Métabolisme de Base au Repos</span>
                </div>
                <div class="tooltip">
                    <div class="flex items-center space-x-2 bg-gray-700 p-4 rounded">
                        <i class="fas fa-utensils text-yellow-500"></i>
                        <span id="dej" class="text-yellow-500">(DEJ)</span>
                    </div>
                    <span class="tooltiptext">Dépense Énergétique Journalière</span>
                </div>
                <div class="tooltip">
                    <div class="flex items-center space-x-2 bg-gray-700 p-4 rounded">
                        <i class="fas fa-bed text-purple-400"></i>
                        <span class="text-purple-400">32</span>
                    </div>
                    <span class="tooltiptext">Heures de Sommeil</span>
                </div>
                <div class="tooltip col-span-2">
                    <div class="bg-gray-700 p-4 rounded">
                        <div class="flex items-center space-x-2">
                            <img src="https://placehold.co/30x30" alt="Character icon" class="rounded-full">
                            <span class="text-yellow-400">11</span>
                        </div>
                        <div class="mt-2">
                            <div class="relative w-full bg-gray-600 rounded">
                                <div class="bg-green-500 text-xs leading-none py-1 text-center text-white rounded" style="width: 55%">55%</div>
                            </div>
                        </div>
                    </div>
                    <span class="tooltiptext">Niveau de Progression du Personnage</span>
                </div>
                <div class="tooltip">
                    <div class="flex items-center space-x-2 bg-gray-700 p-4 rounded">
                        <i class="fas fa-heartbeat text-green-400"></i>
                        <span class="text-green-400">797 / 797</span>
                    </div>
                    <span class="tooltiptext">Points de Vie</span>
                </div>
                <div class="tooltip">
                    <div class="flex items-center space-x-2 bg-gray-700 p-4 rounded">
                        <i class="fas fa-magic text-blue-400"></i>
                        <span class="text-blue-400">487 / 489</span>
                    </div>
                    <span class="tooltiptext">Points de Mana</span>
                </div>
            </div>
        </div>

        <!-- Action Bar -->
        <div class="mt-4 bg-gray-900 p-4 rounded-lg">
            <div class="flex justify-center space-x-2">
                <button class="bg-gray-700 p-2 rounded"><i class="fas fa-bolt"></i></button>
                <button class="bg-gray-700 p-2 rounded"><i class="fas fa-fire"></i></button>
                <button class="bg-gray-700 p-2 rounded"><i class="fas fa-water"></i></button>
                <button class="bg-gray-700 p-2 rounded"><i class="fas fa-leaf"></i></button>
                <button class="bg-gray-700 p-2 rounded"><i class="fas fa-wind"></i></button>
            </div>
        </div>

        <!-- 👾 Energy and Life | Expectancy Calculator Modal 🕹️ -->
        <div id="energyModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center hidden">
            <div class="bg-gray-900 p-8 rounded-lg w-full max-w-2xl">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="hidden text-lg font-bold text-gray-800">Énergie, Fréquence, Vibration</h2>
                    <div class="p-3 bg-dark text-light rounded">
                        <p class="text-sm italic">"Si vous voulez trouver les secrets de l'univers, pensez en termes d'énergie, de fréquence et de vibration." - Nikola Tesla</p>
                    </div>
                    <button id="closeModalBtn" class="text-gray-400 hover:text-gray-200">&times;</button>
                </div>
                <form id="energyForm">
                    <div class="flex flex-wrap -mx-2 mb-4">
                        <div class="w-full md:w-1/2 px-2 mb-4 md:mb-0">
                            <label for="gender" class="block text-gray-400">Gender</label>
                            <select class="form-control block w-full bg-gray-800 text-white border border-gray-700 rounded px-3 py-2" id="gender">
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                        </div>
                        <div class="w-full md:w-1/2 px-2">
                            <label for="age" class="block text-gray-400">Age</label>
                            <input type="number" class="form-control block w-full bg-gray-800 text-white border border-gray-700 rounded px-3 py-2" id="age" placeholder="Enter your age">
                        </div>
                    </div>
                    <div class="flex flex-wrap -mx-2 mb-4">
                        <div class="w-full md:w-1/3 px-2 mb-4 md:mb-0">
                            <label for="weight" class="block text-gray-400">Weight (kg)</label>
                            <input type="number" class="form-control block w-full bg-gray-800 text-white border border-gray-700 rounded px-3 py-2" id="weight" placeholder="Enter your weight" value="62" min="2.1" max="635">
                        </div>
                        <div class="w-full md:w-1/3 px-2 mb-4 md:mb-0">
                            <label for="height" class="block text-gray-400">Height (cm)</label>
                            <input type="number" class="form-control block w-full bg-gray-800 text-white border border-gray-700 rounded px-3 py-2" id="height" placeholder="Enter your height" value="165" min="54.6" max="272">
                        </div>
                        <div class="w-full md:w-1/3 px-2">
                            <label for="activity" class="block text-gray-400">Activity Level</label>
                            <input type="number" step="0.1" class="form-control block w-full bg-gray-800 text-white border border-gray-700 rounded px-3 py-2" id="activity" placeholder="Enter activity level" value="1.5" min="1.2" max="1.8">
                        </div>
                    </div>
                </form>
                <div class="mt-4">
                    <p id="ageDisplay" class="text-gray-400 mt-2"></p>
                </div>
            </div>
        </div>
    </div>

    <script src="modalEnergyCalculator.js"></script>
    <script src="cameraCapture.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const characterBtn = document.getElementById('character-btn');
            const energyModal = document.getElementById('energyModal');
            const closeModalBtn = document.getElementById('closeModalBtn');

            characterBtn.addEventListener('click', () => {
                energyModal.classList.remove('hidden');
            });

            closeModalBtn.addEventListener('click', () => {
                energyModal.classList.add('hidden');
            });

            // Show modal on page load
            energyModal.classList.remove('hidden');

            const inputs = document.querySelectorAll('#gender, #age, #weight, #height, #activity');
            inputs.forEach(input => {
                input.addEventListener('input', calculateEnergy);
            });

            function calculateBMR(gender, weight, height, age) {
                if (gender === 'male') {
                    return (10 * weight) + (6.25 * height) - (5 * age) + 5;
                } else {
                    return (10 * weight) + (6.25 * height) - (5 * age) - 161;
                }
            }

            function calculateDEJ(bmr, activityLevel) {
                return bmr * activityLevel;
            }

            function calculateLifeExpectancyPercentage(gender, age) {
                const lifeExpectancy = gender === 'male' ? 80.0 : 85.7;
                const remainingLifeYears = Math.max(lifeExpectancy - age, 0);
                return { percentage: (remainingLifeYears / lifeExpectancy) * 100, lifeExpectancy };
            }

            function calculateEnergy() {
                const gender = document.getElementById('gender').value;
                const weight = parseFloat(document.getElementById('weight').value);
                const height = parseFloat(document.getElementById('height').value);
                const age = parseInt(document.getElementById('age').value, 10);
                const activityLevel = parseFloat(document.getElementById('activity').value);

                if (weight > 0 && height > 0 && age > 0 && activityLevel > 0) {
                    const bmr = calculateBMR(gender, weight, height, age);
                    const dej = calculateDEJ(bmr, activityLevel);
                    document.getElementById('bmr').innerHTML = `Métabolisme de Base au Repos (MBR) ${bmr.toFixed(0)} kcal/jour`;
                    document.getElementById('dej').innerHTML = `Dépense Énergétique Journalière (DEJ) ${dej.toFixed(0)} kcal/jour`;
                    document.getElementById('nap').innerHTML = `Niveau d'Activité Physique (NAP) ${activityLevel.toFixed(2)}`;
                    updateLifeExpectancy(gender, age);
                } else {
                    document.getElementById('bmr').innerHTML = "Please fill all fields with valid values to calculate BMR and DEJ.";
                }
            }

            function updateLifeExpectancy(gender, age) {
                if (age > 0) {
                    const lifeData = calculateLifeExpectancyPercentage(gender, age);
                    const lifePercentageFormatted = `(${lifeData.percentage.toFixed(0)}%) ${age} / ${lifeData.lifeExpectancy.toFixed(1)} years`;
                    document.getElementById('ageDisplay').innerHTML = `Age: ${age}`;
                    document.getElementById('lifePercentage').innerHTML = lifePercentageFormatted;
                    document.getElementById('lifePercentage').style.width = `${lifeData.percentage.toFixed(2)}%`;

                    // Update additional info section
                    document.getElementById('displayed-age').innerHTML = age;
                    updateAgeProgressBar(age, gender);
                }
            }

            function updateAgeProgressBar(age, gender) {
                const lifeExpectancy = (gender === 'male') ? 80.0 : 85.7;
                const agePercentage = ((age / lifeExpectancy) * 100).toFixed(2);
                const ageProgressBarContainer = document.getElementById('ageProgressBarContainer');
                ageProgressBarContainer.innerHTML = `
                    <div class="rounded bg-green-500 relative overflow-hidden">
                        <div class="bg-green-700 text-black text-lg px-2 rounded" style="width: ${agePercentage}%; max-width: 100%; white-space: nowrap;">
                            (${agePercentage}%) ${age} / ${lifeExpectancy}
                        </div>
                    </div>
                `;
            }
        });

        // Capture image from camera
        function captureImage() {
            const video = document.getElementById('camera');
            const canvas = document.getElementById('canvas');
            const replaceableImage = document.getElementById('replaceableImage');

            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true }).then(function (stream) {
                    video.srcObject = stream;
                    video.classList.remove('hidden');

                    const captureButton = document.createElement('button');
                    captureButton.textContent = 'Capture';
                    captureButton.classList.add('bg-blue-500', 'p-2', 'rounded', 'text-white', 'mt-2');
                    document.body.appendChild(captureButton);

                    captureButton.addEventListener('click', () => {
                        const context = canvas.getContext('2d');
                        context.drawImage(video, 0, 0, canvas.width, canvas.height);

                        const imageUrl = canvas.toDataURL('image/png');
                        replaceableImage.src = imageUrl;

                        stream.getTracks().forEach(track => track.stop());
                        video.classList.add('hidden');
                        captureButton.remove();
                    });
                });
            }
        }

        // Change background color based on MBTI type
        function changeBackgroundColor() {
            const mbtiType = document.getElementById('mbti-type').value;
            let bgColor = '';

            switch (mbtiType) {
                case 'ISTJ':
                    bgColor = 'bg-gray-700';
                    break;
                case 'ISFJ':
                    bgColor = 'bg-green-700';
                    break;
                case 'INFJ':
                    bgColor = 'bg-blue-700';
                    break;
                case 'INTJ':
                    bgColor = 'bg-purple-700';
                    break;
                case 'ISTP':
                    bgColor = 'bg-red-700';
                    break;
                case 'ISFP':
                    bgColor = 'bg-yellow-700';
                    break;
                case 'INFP':
                    bgColor = 'bg-pink-700';
                    break;
                case 'INTP':
                    bgColor = 'bg-indigo-700';
                    break;
                case 'ESTP':
                    bgColor = 'bg-orange-700';
                    break;
                case 'ESFP':
                    bgColor = 'bg-teal-700';
                    break;
                case 'ENFP':
                    bgColor = 'bg-cyan-700';
                    break;
                case 'ENTP':
                    bgColor = 'bg-lime-700';
                    break;
                case 'ESTJ':
                    bgColor = 'bg-amber-700';
                    break;
                case 'ESFJ':
                    bgColor = 'bg-rose-700';
                    break;
                case 'ENFJ':
                    bgColor = 'bg-fuchsia-700';
                    break;
                case 'ENTJ':
                    bgColor = 'bg-violet-700';
                    break;
                default:
                    bgColor = 'bg-gray-800';
            }

            document.body.className = `${bgColor} text-white font-sans leading-normal tracking-normal`;
        }
    </script>
</body>

</html>
